{"version":3,"sources":["../../../source/lib/drawing/headerFooterPicture.js"],"names":["Drawing","require","path","imgsz","mime","uniqueId","EMU","xmlbuilder","headerFooterPicture","opts","kind","type","imagePath","image","_name","name","basename","size","_pxWidth","width","_pxHeight","height","_extension","extname","substr","contentType","getType","scale","_descr","_title","_id","noGrp","noSelect","noRot","noChangeAspect","noMove","noResize","noEditPoints","noAdjustHandles","noChangeArrowheads","noChangeShapeType","xmlele","headerFooterPositions","ind","indexOf","position","_scale","x_width","Math","round","x_height","sh","ele","att","rId","id","newName","desc","title","inWidth","emu","value","inHeight","module","exports"],"mappings":"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","file":"headerFooterPicture.js","sourcesContent":["const Drawing = require('./drawing.js');\nconst path = require('path');\nconst imgsz = require('image-size');\nconst mime = require('mime');\nconst uniqueId = require('lodash.uniqueid');\n\nconst EMU = require('../classes/emu.js');\nconst xmlbuilder = require('xmlbuilder');\n\nclass headerFooterPicture extends Drawing {\n    /**\n     * Element representing an Excel Picture subclass of Drawing\n     * @property {String} kind Kind of picture (currently only image is supported)\n     * @property {String} type ooxml schema\n     * @property {String} imagePath Filesystem path to image\n     * @property {Buffer} image Buffer with image\n     * @property {String} contentType Mime type of image\n     * @property {String} description Description of image\n     * @property {String} title Title of image\n     * @property {String} id ID of image\n     * @property {String} noGrp pickLocks property\n     * @property {String} noSelect pickLocks property\n     * @property {String} noRot pickLocks property\n     * @property {String} noChangeAspect pickLocks property\n     * @property {String} noMove pickLocks property\n     * @property {String} noResize pickLocks property\n     * @property {String} noEditPoints pickLocks property\n     * @property {String} noAdjustHandles pickLocks property\n     * @property {String} noChangeArrowheads pickLocks property\n     * @property {String} noChangeShapeType pickLocks property\n     * @returns {Picture} Excel Picture  pickLocks property\n     */\n    constructor(opts) {\n        super();\n        this.kind = 'image';\n        this.type = 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/image';\n        this.imagePath = opts.path;\n        this.image = opts.image;\n\n        this._name = this.image ?\n            opts.name || uniqueId('image-') :\n            opts.name || path.basename(this.imagePath);\n\n        const size = imgsz(this.imagePath || this.image);\n\n        this._pxWidth = size.width;\n        this._pxHeight = size.height;\n\n        this._extension = this.image ?\n            size.type :\n            path.extname(this.imagePath).substr(1);\n\n        this.contentType = mime.getType(this._extension);\n        this.scale = opts.scale;\n\n        this._descr = null;\n        this._title = null;\n        this._id;\n        // picLocks ยง20.1.2.2.31 picLocks (Picture Locks)\n        this.noGrp;\n        this.noSelect;\n        this.noRot;\n        this.noChangeAspect = true;\n        this.noMove;\n        this.noResize;\n        this.noEditPoints;\n        this.noAdjustHandles;\n        this.noChangeArrowheads;\n        this.noChangeShapeType;\n    }\n\n    get name() {\n        return this._name;\n    }\n    set name(newName) {\n        this._name = newName;\n    }\n    get id() {\n        return this._id;\n    }\n    set id(id) {\n        this._id = id;\n    }\n\n    get rId() {\n        return 'rId' + this._id;\n    }\n\n    get description() {\n        return this._descr !== null ? this._descr : this._name;\n    }\n    set description(desc) {\n        this._descr = desc;\n    }\n\n    get title() {\n        return this._title !== null ? this._title : this._name;\n    }\n    set title(title) {\n        this._title = title;\n    }\n\n    get extension() {\n        return this._extension;\n    }\n\n    get width() {\n        let inWidth = this._pxWidth / 96;\n        let emu = new EMU(inWidth + 'in');\n        return emu.value;\n    }\n\n    get height() {\n        let inHeight = this._pxHeight / 96;\n        let emu = new EMU(inHeight + 'in');\n        return emu.value;\n    }\n\n    /**\n     * @alias Picture.addToXMLele\n     * @desc When generating Workbook output, attaches pictures to the drawings xml file\n     * @func Picture.addToXMLele\n     * @param {xmlbuilder.Element} xmlele Element object of the xmlbuilder module\n     */\n    addToXMLele(xmlele) {\n        const headerFooterPositions = ['LF','CF', 'RF', 'LH', 'CH', 'RH'];\n        var ind = headerFooterPositions.indexOf(this.position);\n        \n        //Size calculations see: https://stackoverflow.com/a/14369133/14456373, http://lcorneliussen.de/raw/dashboards/ooxml/\n        let _scale = 1.0; if(this.scale) _scale = this.scale; \n        let x_width = Math.round((this.width * _scale) / 12700); \n        let x_height = Math.round((this.height * _scale) / 12700);\n        \n\n        var sh = xmlele.ele('v:shape');\n        sh.att('id', this.position).att('o:spid', '_x0000_s' + 1025 + ind).att('type', '#_x0000_t75')\n            .att('style', `position:absolute;margin-left:0;margin-top:0;width:${x_width};height:${x_height};z-index:${ind+1}`);\n        sh.ele('v:imagedata').att('o:relid', this.rId).att('o:title', 'image' + this.id)\n        sh.ele('o:lock').att('v:ext', 'edit').att('rotation', 't');\n    }\n}\n\nmodule.exports = headerFooterPicture;"]}